window.BFt={},BFt.state="INIT",BFt.changedStateInCycle=0,BFt.changeState=function(e){e!=BFt.state&&(BFt.state=e,BFt.changedStateInCycle=1,jQuery.event.trigger("stateChanged",{}))},window.onbeforeunload=function(){for(var e in BFt)BFt[e].socket.close(16,"page closing")},window.BFtObject=function(){var e=new Object;return e.socket=new Object,e.status="INIT",e.subscribed={distance:0,orientation:0,attitude:0,magnetometer:0,touch:0,audiojack:0,powersource:0,rxembedded:0},e.subscribeFunctions={distance:0,orientation:0,attitude:0,magnetometer:0,touch:0,audiojack:0,powersource:0,rxembedded:0},e.setupSocket=e.start=function(s){if(""==s)return void(s="192.168.1.:9092");-1==s.indexOf(":")&&(s+=":9092"),"Firefox"==BrowserDetect.browser?console.error("Websocket not supported. Please use Safari or Chrome."):e.socket=new ReconnectingWebSocket(get_appropriate_ws_url(s));try{e.socket.onopen=function(){e.status="OPEN",jQuery.event.trigger("socketOpened",[]),e.retrial=0;for(var s in e.subscribed)e.subscribed[s]&&e.subscribeFunctions[s]();try{socketOpened()}catch(t){}},e.socket.onmessage=function(s){try{messageObject=JSON.parse(s.data)}catch(t){console.warn("error loading JSON",s,t)}var r=e.socket.url.replace(e.socket.url.slice(-5),"");if(r=r.slice(5),"x"==messageObject.m)return void jQuery.event.trigger("ping",{address:r});if(console.info('::: ----> received:"'+messageObject.m+'"',messageObject),"touched"!=messageObject.m)if("a"==messageObject.m)jQuery.event.trigger("a",{address:r,r:messageObject.r,y:messageObject.y,p:messageObject.p});else if("rx"==messageObject.m)jQuery.event.trigger("receivedRx",{address:r,v:messageObject.v});else if("orientationChanged"==messageObject.m){e.orientation=messageObject.value;try{orientationChanged(r,e.orientation)}catch(t){}jQuery.event.trigger("orientationChanged",{address:r,value:messageObject.value})}else if("magnetometerUpdate"==messageObject.m){e.magnetometer=messageObject.t,e.magnetometerIntensity=messageObject.i;try{magnetometerEvent(r,e.magnetometer,e.magnetometerIntensity)}catch(t){}jQuery.event.trigger("magnetometerEvent",{address:r,i:messageObject.i,t:messageObject.t})}else if("distanceChanged"==messageObject.m){e.proximity=messageObject.proximity;try{distanceChanged(r,e.proximity)}catch(t){}jQuery.event.trigger("distanceChanged",{address:r,p:messageObject.proximity})}else if("audioJackChanged"==messageObject.m){e.audiojack=messageObject["in"];try{audioJackChanged(r,e.audiojack)}catch(t){}jQuery.event.trigger("audioJackChanged",{address:r,"in":messageObject["in"]})}else if("powerSourceChanged"==messageObject.m){e.powersource=messageObject.source;try{powerSourceChanged(r,e.powersource)}catch(t){}jQuery.event.trigger("powerSourceChanged",{address:r,"in":messageObject.source})}else if("batteryGet"==messageObject.m){e[boardNumReceived].batteryLevel=messageObject.value;try{gotBatteryLevel(messageObject.value)}catch(t){}jQuery.event.trigger("gotBatteryLevel",{address:r,batteryLevel:messageObject.value})}else"error"==messageObject.m?console.warn(messageObject.type):"test"==messageObject.m&&console.log(Date.now());else{0==messageObject.value||"0"==messageObject.value?e.touched=!1:(e.touched=!0,jQuery.event.trigger("touched",{address:r,x:messageObject.x,y:messageObject.y}));try{touched(r,messageObject.x,messageObject.y)}catch(t){}}},e.socket.onclose=function(){e.status="CLOSED",console.warn("connection: %s",e.status,e.socket)},e.socket.onerror=function(){e.status="ERROR"}}catch(t){alert("<p>Error"+t),e.status="ERROR"}},e.setServoEmbedded=function(e,s){2==arguments.length&&this.sendMessage('{"m":"srv","n":'+e+',"v":'+s+"}")},e.setRelayEmbedded=function(e,s){2==arguments.length&&this.sendMessage('{"m":"rel","n":'+e+',"v":'+Math.round(s)+"}")},e.doTxEmbedded=function(e){1==arguments.length&&this.sendMessage('{"m":"tx","v":'+e+"}")},e.setColorEmbedded=function(e,s,t,r,n){5==arguments.length&&this.sendMessage('{"m":"col","n":"'+e+'","r":"'+Math.floor(s)+'","g":"'+Math.floor(t)+'","b":"'+Math.floor(r)+'","a":"'+Math.floor(n)+'"}')},e.setColor=function(e,s,t,n){if(4==arguments.length&&((e>1||s>1||t>1)&&(e/=255,s/=255,t/=255,n/=255),this.sendMessage('{"m":"setColor","r":"'+e+'","g":"'+s+'","b":"'+t+'","a":"'+n+'"}')),1==arguments.length&&arguments[0].hasOwnProperty(r)){var a=e;(a.r>1||a.g>1||a.b>1)&&(a.r=a.r/255,a.g=a.g/255,a.b=a.b/255,a.a=a.a/255),this.sendMessage('{"m":"setColor","r":"'+a.r+'","g":"'+a.g+'","b":"'+a.b+'","a":"'+a.a+'"}')}},e.setLED=function(e){this.sendMessage(e>0&&1>=e?'{"m":"setLED","value":"1","in":"'+e+'"}':'{"m":"setLED","value":"0"}')},e.pulseLED=function(e,s,t){3==arguments.length?this.sendMessage('{"m":"pulseLED","t":"'+e+'","d":"'+s+'","i":"'+t+'"}'):console.warn("pulseLED requires 3 inputs: numberOfPulses,duration,intensity")},e.showImage=function(e){"string"==typeof e?this.sendMessage('{"m":"showImage","url":"'+e+'"}'):console.warn("showImage requires a string input")},e.playVideo=function(e){"string"==typeof e?this.sendMessage('{"m":"playVideo","url":"'+e+'"}'):console.warn("playVideo requires a string input")},e.playAudio=function(e){"string"==typeof e?this.sendMessage('{"m":"playAudio","url":"'+e+'"}'):console.warn("playAudio requires a string input")},e.setBrightness=function(e){isNumber(e)?this.sendMessage('{"m":"setBrightness","b":"'+e+'"}'):console.warn("setBrighness requires one numerical parameter")},e.transitionColors=function(e,s,t){3==arguments.length?(isNumber(t)||(t=5,console.warn("transitionColors: duration is not a number")),this.sendMessage('{"m":"transitionColors","r1":"'+e.r+'","g1":"'+e.b+'","b1":"'+e.g+'","a1":"'+e.a+'","r2":"'+s.r+'","g2":"'+s.g+'","b2":"'+s.b+'","a2":"'+s.a+'","duration":"'+t+'"}')):console.warn("transitionColors requires 3 parameters: color1,color2,duration")},e.getBatteryLevel=function(){var s='{"m":"getBattery"}';e.sendMessage(s)},e.subscribeFunctions.distance=e.subscribeDistance=function(){e.subscribed.distance=1,e.sendMessage('{"m":"registerDistance"}')},e.releaseDistance=function(){e.subscribed.distance=0,e.sendMessage('{"m":"releaseDistance"}')},e.subscribeFunctions.touch=e.subscribeTouch=function(){e.subscribed.touch=1,e.sendMessage('{"m":"registerTouch"}')},e.releaseTouch=function(){e.subscribed.touch=0,e.sendMessage('{"m":"releaseTouch"}')},e.subscribeFunctions.attitude=e.subscribeAttitude=function(s){e.subscribed.attitude=1,e.sendMessage('{"m":"registerAttitude","f":"'+s+'"}')},e.releaseAttitude=function(){e.subscribed.attitude=0,e.sendMessage('{"m":"releaseAttitude"}')},e.subscribeFunctions.audiojack=e.subscribeAudioJack=function(){e.subscribed.audiojack=1,e.sendMessage('{"m":"registerAudioJack"}')},e.subscribeFunctions.powersource=e.subscribePowerSource=function(){e.subscribed.powersource=1,e.sendMessage('{"m":"registerPowerSource"}')},e.subscribeFunctions.magnetometer=e.subscribeMagnetometer=function(){e.subscribed.magnetometer=1,e.sendMessage('{"m":"registerMagnetometer"}')},e.releaseMagnetometer=function(){e.subscribed.magnetometer=0,e.sendMessage('{"m":"releaseMagnetometer"}')},e.subscribeFunctions.orientation=e.subscribeOrientation=function(){e.subscribed.orientation=1;var s='{"m":"registerOrientation"}';e.sendMessage(s)},e.releaseOrientation=function(){var s='{"m":"releaseOrientation"}';e.subscribed.orientation=0,e.sendMessage(s)},e.subscribeFunctions.rxembedded=e.subscribeRxEmbedded=function(){var s='{"m":"srx"}';e.subscribed.rxembedded=1,e.sendMessage(s)},e.releaseRxEmbedded=function(){e.subscribed.rxembedded=0,e.sendMessage('{"m":"drx"}')},e.makeVibrate=function(s){var t;t=""!=s&&void 0!=s&&""!=s?'{"m":"makeVibrate","duration":"'+s+'"}':'{"m":"makeVibrate"}',e.sendMessage(t)},e.sendMessage=function(s){try{e.socket.send(s),e.retrial=0}catch(t){e.retrial<3?(e.socket.refresh(),e.retrial++,setTimeout(function(){e.sendMessage(s)},100)):console.warn("communication error: "+t)}},e};