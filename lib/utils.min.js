function isNumber(e){return!isNaN(parseFloat(e))}function get_appropriate_ws_url(e){var n,t=document.URL;"https"==t.substring(0,5)?(n="wss://",t=t.substr(8)):(n="ws://","http"==t.substring(0,4)&&(t=t.substr(7))),t=t.split("/");var i="";return i=""==e?t[0]:e,n+i}function clamp(e,n,t){return n>e?e=n:e>t?e=t:e}var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var n=0;n<e.length;n++){var t=e[n].string,i=e[n].prop;if(this.versionSearchString=e[n].versionSearch||e[n].identity,t){if(-1!=t.indexOf(e[n].subString))return e[n].identity}else if(i)return e[n].identity}},searchVersion:function(e){var n=e.indexOf(this.versionSearchString);if(-1!=n)return parseFloat(e.substring(n+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();var pos=0;String.prototype.replaceAll=function(e,n){var t=this;return t.replace(new RegExp(e,"g"),n)},!function(e,n){"function"==typeof define&&define.amd?define([],n):"undefined"!=typeof module&&module.exports?module.exports=n():e.ReconnectingWebSocket=n()}(this,function(){function e(n,t,i){function o(e,n){var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,n),t}var r={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3};i||(i={});for(var s in r)this[s]="undefined"!=typeof i[s]?i[s]:r[s];this.url=n,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var c,a=this,u=!1,g=!1,d=document.createElement("div");d.addEventListener("open",function(e){a.onopen(e)}),d.addEventListener("close",function(e){a.onclose(e)}),d.addEventListener("connecting",function(e){a.onconnecting(e)}),d.addEventListener("message",function(e){a.onmessage(e)}),d.addEventListener("error",function(e){a.onerror(e)}),this.addEventListener=d.addEventListener.bind(d),this.removeEventListener=d.removeEventListener.bind(d),this.dispatchEvent=d.dispatchEvent.bind(d),this.open=function(n){c=new WebSocket(a.url,t||[]),n||d.dispatchEvent(o("connecting")),(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",a.url);var i=c,r=setTimeout(function(){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",a.url),g=!0,i.close(),g=!1},a.timeoutInterval);c.onopen=function(){clearTimeout(r),(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",a.url),a.protocol=c.protocol,a.readyState=WebSocket.OPEN,a.reconnectAttempts=0;var t=o("open");t.isReconnect=n,n=!1,d.dispatchEvent(t)},c.onclose=function(t){if(clearTimeout(r),c=null,u)a.readyState=WebSocket.CLOSED,d.dispatchEvent(o("close"));else{a.readyState=WebSocket.CONNECTING;var i=o("connecting");i.code=t.code,i.reason=t.reason,i.wasClean=t.wasClean,d.dispatchEvent(i),n||g||((a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",a.url),d.dispatchEvent(o("close")));var r=a.reconnectInterval*Math.pow(a.reconnectDecay,a.reconnectAttempts);setTimeout(function(){a.reconnectAttempts++,a.open(!0)},r>a.maxReconnectInterval?a.maxReconnectInterval:r)}},c.onmessage=function(n){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",a.url,n.data);var t=o("message");t.data=n.data,d.dispatchEvent(t)},c.onerror=function(n){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",a.url,n),d.dispatchEvent(o("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(c)return(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",a.url,n),c.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),u=!0,c&&c.close(e,n)},this.refresh=function(){c&&c.close()}}return e.prototype.onopen=function(){},e.prototype.onclose=function(){},e.prototype.onconnecting=function(){},e.prototype.onmessage=function(){},e.prototype.onerror=function(){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e});